<!-- 
    Test Case: SUPSRV CW SET and QUERY.
-->
<tapp>
    <testcase name="SUPSRV CW QUERY - Cannot reach AS">
        <!--
            scenario: Cannot reach AS 
            Note: We assume CW default is disabled.
            AT+CCWA=,2
            +CME ERROR: 31
        -->
        <action type="issue at">AT+CCWA=,2&#13;</action>

        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_FETCH</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_NET</error>
                </event>
            </xcap>
        </action>

        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">+CME ERROR: 31&#13;</action>
    </testcase>
    <testcase name="SUPSRV CW QUERY - HTTP error">
        <!--
            scenario: HTTP error
            AT+CCWA=,2
            +CME ERROR: 100
        -->
        <action type="issue at">AT+CCWA=,2&#13;</action>

        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_FETCH</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_NONE</error>
                    <header type="string"><![CDATA[HTTP/1.1 404 Not Found
                    ]]>
                    </header>
                </event>
            </xcap>
        </action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">+CME ERROR: 100&#13;</action>
    </testcase>
    <testcase name="SUPSRV CW QUERY - XML parse error">
        <!--
            scenario: XML parse error
            AT+CCWA?
            +CME ERROR: 100
        -->
        <action type="issue at">AT+CCWA=,2&#13;</action>

        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_FETCH</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_NONE</error>
                    <header type="string"><![CDATA[HTTP/1.1 200 OK
                        Server: XDM-serv/OMA2.0
                        Date: Mon, 04 March 2013 10:50:39 GMT
                        Etag: "eti87"
                        Content-Type:application/simservs+xml; charset="utf-8" 
                        Content-Length: 686
                    ]]>
                    </header>
                    <body type="string"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
                        <simservs xmlns="http://uri.etsi.org/ngn/params/xml/simservs/xcap" 
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
                           <communication-waiting/>
                        </simservs>
                    ]]>
                    </body>
                </event>
            </xcap>
        </action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">+CME ERROR: 100&#13;</action>
    </testcase>
    <testcase name="SUPSRV CW QUERY - Cannot fetch xml doc">
        <!--
            scenario: Cannot fetch related doc at AS, consider it not provisioned
            AT+CCWA=,2
            Note: We assume CW default is disabled.
            +CME ERROR: 30
        -->
        <action type="issue at">AT+CCWA=,2&#13;</action>

        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_FETCH</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_HTTP</error>
                </event>
            </xcap>
        </action>

        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">+CME ERROR: 30&#13;</action>
    </testcase>
    <testcase name="SUPSRV enable CW">
    <!--
        scenario: Set CW to active
        AT+CCWA=,1
        OK
        AT+CCWA
        +CCWA: ,1
        OK
    -->
        <action type="issue at">AT+CCWA=,1&#13;</action>
        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_CREATE_REPLACE</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                    <body type="string"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<simservs xmlns:cp="urn:ietf:params:xml:ns:common-policy"
xmlns="http://uri.etsi.org/ngn/params/xml/simservs/xcap"
xmlns:ocp="urn:oma:xml:xdm:common-policy"><communication-waiting active="true"/>
</simservs>]]>
                    </body>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_NONE</error>
                    <header type="string"><![CDATA[HTTP/1.1 200 OK
                        Server: XDM-serv/OMA2.0
                        Date: Mon, 04 March 2013 10:50:39 GMT
                        Etag: "eti87"
                        Content-Type:application/simservs+xml; charset="utf-8" 
                        Content-Length: 0
                    ]]>
                    </header>
                </event>
            </xcap>
        </action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">0&#13;&#10;</action>
        <!-- Query -->
        <action type="issue at">AT+CCWA=,2&#13;</action>

        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_FETCH</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_NONE</error>
                    <header type="string"><![CDATA[HTTP/1.1 200 OK
                        Server: XDM-serv/OMA2.0
                        Date: Mon, 04 March 2013 10:50:39 GMT
                        Etag: "eti87"
                        Content-Type:application/simservs+xml; charset="utf-8" 
                        Content-Length: 686
                    ]]>
                    </header>
                    <body type="string"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
                        <simservs xmlns="http://uri.etsi.org/ngn/params/xml/simservs/xcap" 
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
                           <communication-waiting active="true">
                               <default-behaviour>presentation-restricted</default-behaviour>
                           </communication-waiting>
                        </simservs>
                    ]]>
                    </body>
                </event>
            </xcap>
        </action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="validate at" timeout="2000" onFail="stop">+CCWA: 1,1&#13;&#10;0&#13;&#10;</action>
    </testcase>
    <testcase name="SUPSRV disable CW">
        <!--
            scenario: Set CW to inactive.
            AT+CCWA=,0
            OK
            AT+CCWA=,2
            +CCWA: 0,1
        -->
        <action type="issue at">AT+CCWA=,0&#13;</action>
        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_CREATE_REPLACE</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                    <body type="string"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<simservs xmlns:cp="urn:ietf:params:xml:ns:common-policy"
xmlns="http://uri.etsi.org/ngn/params/xml/simservs/xcap"
xmlns:ocp="urn:oma:xml:xdm:common-policy"><communication-waiting active="false"/>
</simservs>]]>
                    </body>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_NONE</error>
                    <header type="string"><![CDATA[HTTP/1.1 200 OK
                        Server: XDM-serv/OMA2.0
                        Date: Mon, 04 March 2013 10:50:39 GMT
                        Etag: "eti87"
                        Content-Type:application/simservs+xml; charset="utf-8" 
                        Content-Length: 0
                    ]]>
                    </header>
                </event>
            </xcap>
        </action>

        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">0&#13;&#10;</action>
        <!-- Query -->
        <action type="issue at">AT+CCWA=,2&#13;</action>

        <!-- validate a xcap message -->
        <action type="validate xcap" timeout="2000">
            <xcap>
                <command>
                    <operation type="enum">XCAP_OPERATION_FETCH</operation>
                    <optype type="enum">XCAP_OPERATION_TYPE_DOCUMENT</optype>
                    <condition type="enum">XCAP_CONDITION_NONE</condition>
                    <uri type="string">http://user1:12345678@172.16.0.100:8080/xcap/simservs.ngn.etsi.org/users/sip:+14043351655@foundry.att.com/simservs.xml/~~/simservs/communication-waiting</uri>
                    <username type="string">user1</username>
                    <password type="string">12345678</password>
                    <x3gpp type="string"></x3gpp>
                    <auid type="string">xcap/simservs.ngn.etsi.org</auid>
                    <etag type="string"></etag>
                </command>
            </xcap>
        </action>

        <!-- simulate xcap response as event -->
        <action type="issue xcap">
            <xcap>
                <event>
                    <error type="enum">XCAP_EVT_ERR_NONE</error>
                    <header type="string"><![CDATA[HTTP/1.1 200 OK
                        Server: XDM-serv/OMA2.0
                        Date: Mon, 04 March 2013 10:50:39 GMT
                        Etag: "eti87"
                        Content-Type:application/simservs+xml; charset="utf-8" 
                        Content-Length: 686
                    ]]>
                    </header>
                    <body type="string"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
                        <simservs xmlns="http://uri.etsi.org/ngn/params/xml/simservs/xcap" 
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
                           <communication-waiting active="false">
                           </communication-waiting>
                        </simservs>
                    ]]>
                    </body>
                </event>
            </xcap>
        </action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="validate at" timeout="2000" onFail="stop">+CCWA: 0,1&#13;&#10;0&#13;&#10;</action>
    </testcase>
</tapp>

