<tapp>
    <testcase name="PS: Rejecting CMCC call waiting when disabled ">
        <!-- do "SUPSRV CMCC disable CW" -->
        <!--
            scenario: Set CW to inactive.
            AT+CCWA=,0
            OK
            AT+CCWA=,2
            +CCWA: 0,1
        -->
        <action type="issue at">AT+CCWA=,0&#13;</action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">0&#13;&#10;</action>
        <!-- Query -->
        <action type="issue at">AT+CCWA=,2&#13;</action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="validate at" timeout="2000" onFail="stop">+CCWA: 0,1&#13;&#10;0&#13;&#10;</action>


        <!-- Initiate a call -->
        <action type="issue at">AT+CDU=1,"tel:13800013265",1,1</action>
        <action type="validate isip" timeout="2000">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <protocol  type="int">1</protocol>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_INITIATE</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                    <type type="enum">ISI_SESSION_TYPE_AUDIO</type>
                    <audioDirection type="enum">ISI_SESSION_DIR_SEND_RECV</audioDirection>
                    <to type="string">tel:13800013265</to>
                    <from type="string">4043351655@private.att.net@foundry.att.com</from>
                </call>
            </isip>
        </action>
        <!-- issue isip trying with id index = 0 -->
        <action type="issue isip">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <id type="int">0</id>
                <protocol type="int">1</protocol>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_TRYING</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                </call>
            </isip>
        </action>
        <!--  AT infc verify receiving OK -->
        <action type="validate at" timeout="2000">+CDU: 1&#13;&#10;</action>
        <action type="validate at" timeout="2000">0&#13;</action>
        <!-- issue isip to ACK call with id index = 0 -->
        <action type="issue isip">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <protocol  type="int">0</protocol>
                <id type="int">0</id>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_ACK</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                </call>
            </isip>
        </action>
        <action type="pause">50</action>
        <action type="validate at" timeout="2000">+CMCCSI: 1,0,0,0,"",0,2,0,1,0,"tel:13800013265",0,0&#13;&#10;</action>
        <!-- issue isip to accept call with id index = 0 -->
        <action type="issue isip">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <protocol  type="int">0</protocol>
                <id type="int">0</id>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_ACCEPT</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                </call>
            </isip>
        </action>
        <!--  issue accept ack with id index = 0 -->
        <action type="issue isip">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <id type="int">0</id>
                <protocol  type="int">0</protocol>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_ACCEPT_ACK</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                    <audioDirection type="enum">ISI_SESSION_DIR_SEND_RECV</audioDirection>
                </call>
            </isip>
        </action>
        <action type="pause">50</action>
        <action type="validate at" timeout="2000">+CMCCSI: 1,0,0,0,"",0,3,0,1,0,"tel:13800013265",0,0&#13;&#10;</action>
        <action type="validate at" timeout="2000">+CMCCSI: 1,0,0,0,"",0,4,0,1,0,"tel:13800013265",0,0&#13;&#10;</action>
        <action type="validate at" timeout="2000">+CMCCSI: 1,0,1,4,"m=audio",0,4,0,1,0,"tel:13800013265",0,0&#13;&#10;</action>
        <action type="validate at" timeout="2000">+CMCCSI: 1,0,1,1,"",0,6,0,1,0,"tel:13800013265",0,0&#13;&#10;</action>

        <!-- Issue an incoming call to CSM -->
        <action type="issue isip">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <protocol type="int">1</protocol>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_INITIATE</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                    <type type="enum">ISI_SESSION_TYPE_AUDIO</type>
                    <audioDirection type="enum">ISI_SESSION_DIR_SEND_RECV</audioDirection>
                    <from type="string">tel:13800013266</from>
                    <subject type="string">Whatever</subject>
                </call>
            </isip>
        </action>
        <!--  ISIP Valide call reject with call id index=1 -->
        <action type="validate isip" timeout="3000">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <protocol type="int">0</protocol>
                <id type="int">1</id>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_REJECT</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                    <type type="enum">ISI_SESSION_TYPE_AUDIO</type>
                    <audioDirection type="enum">ISI_SESSION_DIR_SEND_RECV</audioDirection>
                    <reasonDesc type="string">486 Busy Here</reasonDesc>
                </call>
            </isip>
        </action>
        <!-- issue isip that call was terminated  with id index=1 -->
        <action type="issue isip">
            <isip>
                  <code type="enum">ISIP_CODE_CALL</code>
                   <protocol type="int">0</protocol>
                   <id type="int">1</id>
                   <call>
                      <reason type="enum">ISIP_CALL_REASON_TERMINATE</reason>
                       <status type="enum">ISIP_STATUS_DONE</status>
                   </call>
            </isip>
        </action>

        <action type="pause">50</action>
        <!-- Remote party Disconnects call index = 0 -->
        <action type="issue isip">
            <isip>
                <code type="enum">ISIP_CODE_CALL</code>
                <protocol  type="int">0</protocol>
                <id type="int">0</id>
                <call>
                    <reason type="enum">ISIP_CALL_REASON_TERMINATE</reason>
                    <status type="enum">ISIP_STATUS_INVALID</status>
                </call>
            </isip>
        </action>                    
        <action type="validate at" timeout="2000">+CMCCSI: 1,0,0,0,"",0,7,0,1,0,"tel:13800013265",0,0&#13;&#10;</action>
        <action type="pause">50</action>

        <!-- do "SUPSRV CMCC enable CW back" -->
        <!--
            scenario: Set CW to active
            AT+CCWA=,1
            OK
            AT+CCWA=,2
            +CCWA: 1,1
            OK
        -->
        <action type="issue at">AT+CCWA=,1&#13;</action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="pause">10</action>
        <action type="validate at" timeout="2000" onFail="stop">0&#13;&#10;</action>
        <!-- Query -->
        <action type="issue at">AT+CCWA=,2&#13;</action>
        <!-- AT infc verify receiving the parsed CW query result. -->
        <action type="validate at" timeout="2000" onFail="stop">+CCWA: 1,1&#13;&#10;0&#13;&#10;</action>
    </testcase>
</tapp>
